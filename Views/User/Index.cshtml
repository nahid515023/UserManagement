@model List<UserManagementApp.Models.ViewModels.UserViewModel>
@{
    ViewData["Title"] = "User Management";
}

<div class="container mt-4">
    <h2>User Management</h2>
    
    <div class="toolbar mb-3">
        <form id="userActionForm" method="post">
            <div class="btn-group">
                <button type="button" class="btn btn-danger" id="blockBtn">Block</button>
                <button type="button" class="btn btn-success" id="unblockBtn">
                    <i class="bi bi-unlock"></i>
                </button>
                <button type="button" class="btn btn-dark" id="deleteBtn">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </form>
    </div>
    
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" id="selectAll" />
                    </th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Last Login</th>
                    <th>Registration Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>
                            <input type="checkbox" class="user-checkbox" value="@user.Id" />
                        </td>
                        <td>@user.Name</td>
                        <td>@user.Email</td>
                        <td>@(user.LastLoginTime.HasValue ? user.LastLoginTime.Value.ToString("g") : "Never")</td>
                        <td>@user.RegistrationTime.ToString("g")</td>
                        <td>
                            <span class="badge @(user.IsBlocked ? "bg-danger" : "bg-success")">
                                @(user.IsBlocked ? "Blocked" : "Active")
                            </span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Select all checkbox functionality
            $("#selectAll").change(function() {
                $(".user-checkbox").prop('checked', $(this).prop('checked'));
            });
            
            // Handle toolbar button clicks
            $("#blockBtn").click(function() {
                processSelectedUsers("BlockUsers");
            });
            
            $("#unblockBtn").click(function() {
                processSelectedUsers("UnblockUsers");
            });
            
            $("#deleteBtn").click(function() {
                if (confirm("Are you sure you want to delete the selected users?")) {
                    processSelectedUsers("DeleteUsers");
                }
            });
            
            function processSelectedUsers(action) {
                var selectedUsers = [];
                $(".user-checkbox:checked").each(function() {
                    selectedUsers.push($(this).val());
                });
                
                if (selectedUsers.length === 0) {
                    alert("Please select at least one user.");
                    return;
                }
                
                // Create a form and submit it
                var form = $("#userActionForm");
                form.attr("action", "/User/" + action);
                form.empty();
                
                $.each(selectedUsers, function(i, userId) {
                    form.append('<input type="hidden" name="userIds" value="' + userId + '" />');
                });
                
                form.submit();
            }
        });
    </script>
}